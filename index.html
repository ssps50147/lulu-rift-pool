<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>è£‚ç¸«æ°´æ± ï¼šé¹¿ç²‰æ’ˆæ’ˆç¥­</title>

<style>
/* ===== åŸºæœ¬è‰²ç³» ===== */
:root{
  --pool:#2aa6ff;
  --hud:rgba(255,255,255,.65);
  --ink:#0a1220;
}
body{
  margin:0;
  height:100vh;
  background:radial-gradient(1200px 700px at 50% 20%,#1a325a,#081225);
  font-family:system-ui,"Noto Sans TC","Microsoft JhengHei";
  overflow:hidden;
}
.wrap{height:100%;display:grid;place-items:center;}
.frame{
  position:relative;
  width:100vw;
  height:100dvh;
  background:radial-gradient(circle at 50% 25%,#a7f3ff,var(--pool),#063254);
}
canvas{width:100%;height:100%;display:block}

/* ===== HUD ===== */
.hud{
  position:absolute;top:12px;left:12px;right:12px;
  display:flex;gap:8px;flex-wrap:wrap;z-index:5
}
.card{
  background:var(--hud);
  border-radius:16px;
  padding:8px 12px;
  color:var(--ink);
  flex:1;
  min-width:140px;
}

/* ===== Overlay ===== */
.overlay{
  position:absolute;inset:0;
  background:#0007;
  display:grid;place-items:center;
  z-index:10
}
.panel{
  background:#fff;
  border-radius:22px;
  padding:18px;
  max-width:90%;
  color:#111;
}

/* ===== Buttons ===== */
button{
  padding:10px 14px;
  border-radius:18px;
  border:none;
  background:#111;
  color:#fff;
  font-weight:800;
  cursor:pointer;
}

/* ===== Toast ===== */
.toast{
  position:absolute;top:90px;left:12px;right:12px;
  background:#fff9;
  border-radius:16px;
  padding:10px 12px;
  opacity:0;
  transition:.25s;
  z-index:20
}
.toast.show{opacity:1}

/* ===== LIFF ===== */
.liffbar{
  position:absolute;top:12px;right:12px;z-index:30
}
.liffbar button{
  background:#000a;color:#fff
}

/* ===== ç›´å‘é–å®šé®ç½© ===== */
.portrait-lock{
  position:absolute;inset:0;
  display:none;
  backdrop-filter:blur(10px);
  background:rgba(0,0,0,.5);
  place-items:center;
  z-index:50
}
.portrait-lock__content{
  text-align:center;
  color:#fff;
  font-weight:900
}
.rotate-icon{
  font-size:64px;
  margin-bottom:12px;
  animation:rotatePhone 1.4s infinite
}
@keyframes rotatePhone{
  0%{transform:rotate(0)}
  25%{transform:rotate(-20deg)}
  50%{transform:rotate(0)}
  75%{transform:rotate(20deg)}
  100%{transform:rotate(0)}
}

/* ===== å¤œé–“ï¼ˆé‡‘é­šä¹‹å¤œï¼‰æ¨£å¼ ===== */
body.fish-night{
  --pool:#ffb347;
  --hud:rgba(255,245,210,.78);
}
body.fish-night .card{border-radius:24px}
body.fish-night .panel{
  background:linear-gradient(180deg,#fff0c8,#ffd78c);
  border-radius:30px
}
body.fish-night .panel h2{color:#6a3b00}
</style>
</head>

<body>
<div class="wrap">
<div class="frame">

<div class="liffbar" id="liffBar" style="display:none">
  <button onclick="liff.closeWindow()">é—œé–‰</button>
</div>

<canvas id="c" width="1280" height="720"></canvas>

<div class="hud">
  <div class="card">åˆ†æ•¸ï¼š<b id="score">0</b></div>
  <div class="card">æ™‚é–“ï¼š<b id="time">60</b>s</div>
  <div class="card">ç¨±è™Ÿï¼š<b id="title">æ–°æ‰‹é¹¿ç²‰</b></div>
</div>

<div class="toast" id="toast"></div>

<div class="overlay" id="overlay">
  <div class="panel">
    <h2>ğŸŒŒ è£‚ç¸«æ°´æ± ï¼šé¹¿ç²‰æ’ˆæ’ˆç¥­</h2>
    <p>
      âš¡ è£‚ç¸«æš´èµ°ï¼š12:00â€“14:00<br/>
      ğŸŒ™ é‡‘é­šä¹‹å¤œï¼š19:00â€“21:00
    </p>
    <button onclick="start()">é–‹å§‹éŠæˆ²</button>
  </div>
</div>

<div id="portraitLock" class="portrait-lock">
  <div class="portrait-lock__content">
    <div class="rotate-icon">ğŸ”„</div>
    ğŸ¦’ è«‹æ©«å‘éŠç©
  </div>
</div>

</div>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
/* ===== æ”¹æˆä½ çš„ LIFF ID ===== */
const LIFF_ID = "2008825801-LXHTWx5N";

/* ===== LIFF ===== */
(async()=>{
 try{
  await liff.init({liffId:LIFF_ID});
  if(liff.isInClient()) document.getElementById("liffBar").style.display="block";
 }catch(e){}
})();

/* ===== æ™‚æ®µè¨­å®š ===== */
const FRENZY_START_H=12, FRENZY_END_H=14;
const FISH_START_H=19, FISH_END_H=21;

function isFrenzy(d){const h=d.getHours();return h>=FRENZY_START_H&&h<FRENZY_END_H}
function isFishNight(d){const h=d.getHours();return h>=FISH_START_H&&h<FISH_END_H}

/* ===== éŸ³æ•ˆ ===== */
let actx=null,audioOn=true,nightBgm=null;
function beep(f=440,d=0.05){
 if(!audioOn)return;
 if(!actx)actx=new AudioContext();
 const o=actx.createOscillator(),g=actx.createGain();
 o.frequency.value=f;g.gain.value=0.04;
 o.connect(g);g.connect(actx.destination);
 o.start();o.stop(actx.currentTime+d)
}
function nightBell(){
 if(!audioOn)return;
 if(!actx)actx=new AudioContext();
 const o=actx.createOscillator(),g=actx.createGain();
 o.frequency.value=880;g.gain.value=0.03;
 o.connect(g);g.connect(actx.destination);
 o.start();o.stop(actx.currentTime+0.6)
}
function startNightBgm(){
 if(nightBgm||!audioOn)return;
 if(!actx)actx=new AudioContext();
 const o=actx.createOscillator(),g=actx.createGain();
 o.frequency.value=110;g.gain.value=0.008;
 o.connect(g);g.connect(actx.destination);
 o.start();nightBgm={o,g}
}
function stopNightBgm(){
 if(nightBgm){nightBgm.o.stop();nightBgm=null}
}

/* ===== éŠæˆ²ç‹€æ…‹ ===== */
const c=document.getElementById("c"),ctx=c.getContext("2d");
let score=0,time=60,running=false;
let lastFish=false;

function toast(t){
 const el=document.getElementById("toast");
 el.textContent=t;el.classList.add("show");
 setTimeout(()=>el.classList.remove("show"),2500)
}
function titleFromScore(s){
 if(s>60)return"ç†Ÿç·´é¹¿ç²‰";
 if(s>30)return"è¦‹ç¿’é¹¿ç²‰";
 return"æ–°æ‰‹é¹¿ç²‰"
}
function displayTitle(){
 const base=titleFromScore(score);
 return document.body.classList.contains("fish-night")
  ? `å¤œé–“è§€æ¸¬å“¡ Â· ${base}` : base
}

/* ===== æ–¹å‘é–å®š ===== */
const lock=document.getElementById("portraitLock");
function isPortrait(){return innerHeight>innerWidth}
function updateOrientation(){
 lock.style.display=isPortrait()?"grid":"none"
}
window.addEventListener("resize",updateOrientation);
updateOrientation();

/* ===== ä¸»æµç¨‹ ===== */
function start(){
 if(isPortrait()){toast("ğŸ¦’ è«‹å…ˆæ©«å‘");return}
 document.getElementById("overlay").style.display="none";
 score=0;time=60;running=true
}
function loop(){
 ctx.clearRect(0,0,1280,720);
 const now=new Date();

 if(isFishNight(now)){
  document.body.classList.add("fish-night");
  if(!lastFish){nightBell();startNightBgm();toast("ğŸŒ™ é¹¿é¹¿ä½è²èªªï¼šå¤œé–“ç³»çµ±å·²æ¥ç®¡ã€‚")}
  lastFish=true
 }else{
  document.body.classList.remove("fish-night");
  if(lastFish)stopNightBgm();
  lastFish=false
 }

 if(running){
  score+=isFrenzy(now)?2:1;
  time-=0.016;
  if(time<=0){
    running=false;
    document.getElementById("overlay").style.display="grid";
  }
 }

 ctx.fillStyle=document.body.classList.contains("fish-night")
  ?"rgba(255,215,120,.8)":"rgba(255,255,255,.8)";
 ctx.beginPath();
 ctx.arc(Math.random()*1280,Math.random()*720,6,0,Math.PI*2);
 ctx.fill();

 document.getElementById("score").textContent=score;
 document.getElementById("time").textContent=Math.ceil(time);
 document.getElementById("title").textContent=displayTitle();

 requestAnimationFrame(loop)
}
loop();
</script>
</body>
</html>
